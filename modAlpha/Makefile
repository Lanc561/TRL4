# Makefile –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–≥–æ —à–∏—Ñ—Ä–∞
# –ê–≤—Ç–æ—Ä: –ì–µ–Ω–µ—Ä–∞–ª–æ–≤ –õ.–ö., –í–µ—Ä—Å–∏—è: 1.0, –ì–æ–¥: 2025, –ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ: –ò–ë–°–¢ –ü–ì–£

# –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä
CXX = g++
CXXFLAGS = -std=c++11 -Wall -Wextra

# –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
SRC_DIR = src
INC_DIR = src/headers
SOURCES = src/main.cpp src/modAlphaCipher.cpp
HEADERS = src/headers/modAlphaCipher.h
TARGET = alpha_cipher

# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
DOXYFILE = Doxyfile
DOC_DIR = docs
PDF_OUTPUT = docs/documentation.pdf

# –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å
all: $(TARGET)

# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã
$(TARGET): $(SOURCES) $(HEADERS)
	@echo "=== –°–±–æ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã ==="
	$(CXX) $(CXXFLAGS) -I$(INC_DIR) $(SOURCES) -o $(TARGET)
	@echo "‚úÖ –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å–æ–±—Ä–∞–Ω–∞: $(TARGET)"

# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã
run: $(TARGET)
	@echo "=== –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã ==="
	./$(TARGET)

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
html: $(DOXYFILE) $(SOURCES) $(HEADERS)
	@echo "=== –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ==="
	@mkdir -p $(DOC_DIR)
	doxygen $(DOXYFILE)
	@if [ -f "docs/html/index.html" ]; then \
		echo "‚úÖ HTML –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: docs/html/index.html"; \
	else \
		echo "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è HTML –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏"; \
	fi

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
pdf: $(DOXYFILE) $(SOURCES) $(HEADERS)
	@echo "=== –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ==="
	@echo "–ê–≤—Ç–æ—Ä: –ì–µ–Ω–µ—Ä–∞–ª–æ–≤ –õ.–ö., –í–µ—Ä—Å–∏—è: 1.0, –ì–æ–¥: 2025, –ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ: –ò–ë–°–¢ –ü–ì–£"
	@echo ""
	
	@# 1. –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
	@rm -rf docs/latex docs/documentation.pdf
	@mkdir -p docs
	
	@# 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º Doxygen –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
	@echo "1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Doxygen –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏..."
	@doxygen $(DOXYFILE) 2>&1 | grep -v "warning" || true
	
	@# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–∑–¥–∞–ª–∞—Å—å –ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è latex
	@if [ -d "docs/latex" ]; then \
		echo "2. –ö–æ–º–ø–∏–ª—è—Ü–∏—è LaTeX –≤ PDF..."; \
		cd docs/latex; \
		echo "   –ü–µ—Ä–≤–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è..."; \
		pdflatex -interaction=nonstopmode refman.tex > /dev/null 2>&1; \
		echo "   –í—Ç–æ—Ä–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è..."; \
		pdflatex -interaction=nonstopmode refman.tex > /dev/null 2>&1; \
		if [ -f "refman.idx" ]; then \
			echo "   –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞..."; \
			makeindex refman.idx > /dev/null 2>&1; \
			echo "   –§–∏–Ω–∞–ª—å–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è..."; \
			pdflatex -interaction=nonstopmode refman.tex > /dev/null 2>&1; \
		fi; \
		if [ -f "refman.pdf" ]; then \
			cp refman.pdf ../documentation.pdf; \
			echo ""; \
			echo "‚úÖ PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: docs/documentation.pdf"; \
		else \
			echo "‚ùå –û—à–∏–±–∫–∞: PDF –Ω–µ —Å–æ–∑–¥–∞–Ω"; \
		fi; \
	else \
		echo "‚ùå –û—à–∏–±–∫–∞: Doxygen –Ω–µ —Å–æ–∑–¥–∞–ª LaTeX —Ñ–∞–π–ª—ã"; \
		echo "   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Doxyfile –∏ –Ω–∞–ª–∏—á–∏–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤"; \
	fi

# –í—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (HTML + PDF)
doc: html pdf
	@echo "‚úÖ –í—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞"
	@echo "üìÑ HTML: docs/html/index.html"
	@echo "üìÑ PDF:  docs/documentation.pdf"

# –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
view-html:
	@if [ -f "docs/html/index.html" ]; then \
		echo "–û—Ç–∫—Ä—ã—Ç–∏–µ HTML –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏..."; \
		xdg-open docs/html/index.html 2>/dev/null || \
		open docs/html/index.html 2>/dev/null || \
		echo "–û—Ç–∫—Ä–æ–π—Ç–µ: docs/html/index.html"; \
	else \
		echo "–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é: make html"; \
	fi

view-pdf:
	@if [ -f "docs/documentation.pdf" ]; then \
		echo "–û—Ç–∫—Ä—ã—Ç–∏–µ PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏..."; \
		xdg-open docs/documentation.pdf 2>/dev/null || \
		open docs/documentation.pdf 2>/dev/null || \
		echo "–û—Ç–∫—Ä–æ–π—Ç–µ: docs/documentation.pdf"; \
	else \
		echo "–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ PDF: make pdf"; \
	fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞
check:
	@echo "=== –ü—Ä–æ–≤–µ—Ä–∫–∞ ==="
	@ls -la src/ src/headers/ 2>/dev/null || echo "–î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ src/ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
	@ls -la src/main.cpp src/modAlphaCipher.cpp src/headers/modAlphaCipher.h 2>/dev/null || echo "–ù–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤"
	@which doxygen >/dev/null 2>&1 && echo "‚úÖ Doxygen" || echo "‚ùå Doxygen –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
	@which pdflatex >/dev/null 2>&1 && echo "‚úÖ LaTeX" || echo "‚ùå LaTeX –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
	@echo ""

# –û—á–∏—Å—Ç–∫–∞
clean:
	@echo "–û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞..."
	rm -f $(TARGET)
	rm -rf docs

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞
rebuild: clean all

# –ü–æ–º–æ—â—å
help:
	@echo "=== –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã ==="
	@echo "make           - –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É"
	@echo "make run       - –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É"
	@echo "make html      - –°–æ–∑–¥–∞—Ç—å HTML –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é"
	@echo "make pdf       - –°–æ–∑–¥–∞—Ç—å PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é"
	@echo "make doc       - –°–æ–∑–¥–∞—Ç—å –≤—Å—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é"
	@echo "make view-html - –û—Ç–∫—Ä—ã—Ç—å HTML –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é"
	@echo "make view-pdf  - –û—Ç–∫—Ä—ã—Ç—å PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é"
	@echo "make check     - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"
	@echo "make clean     - –û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç"
	@echo "make rebuild   - –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –≤—Å—ë"
	@echo "make help      - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞"

.PHONY: all run html pdf doc view-html view-pdf check clean rebuild help
